name: Continuous Integration

on:
  push:
    branches:
      - main
      - dev
  pull_request:
    branches:
      - main
      - dev

jobs:
  sematic-pr:
    name: Semantic Pull Request
    uses: VeryGoodOpenSource/very_good_workflows/.github/workflows/semantic_pull_request.yml@v1

  flutter-check:
    name: Build Check
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      - name: 📚 Checkout
        uses: actions/checkout@v3
      
      - name: 🐦 Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          channel: 'stable'
          cache: true

      - name: 🧪 Run Analyze
        run: flutter analyze . --fatal-infos

      - name: 📝 Run Test with Coverage
        run: |
          dart pub global activate full_coverage
          dart pub global run full_coverage
          flutter test --coverage
      
      - name: 📊 Code Coverage
        uses: whynotmake-it/dart-coverage-assistant@d221ca8dc01c04908b2eae56e2ac591cea99741c
        with:
            lower_threshold: 1
            upper_threshold: 50
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
            enforce_threshold: single
            enforce_forbidden_decrease: single

      
   